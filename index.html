<!DOCTYPE html>
<html>
<head lang="ja">
    <meta charset="UTF-8">
    <title>GoogleMapAPIv3 市町村の形</title>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js"></script>
    <style>
        html, body, #canvas {width:100%; height:100%; margin:0px; padding:0px;}
    </style>
</head>
<body>
<div id="canvas"></div>
<script>
window.onload = function() {
    var latLng = new google.maps.LatLng(36.786897, 136.892720);
    var mapOptions = {
        zoom: 9,
        center: latLng
    };
    var div = document.getElementById("canvas");
    div.style.width = div.style.height = '100%';
    var map = new google.maps.Map(div, mapOptions);
    var initCity = '氷見市';
    // シェイプ作成
    var makeShape = function(city) {
        if (city) {
            map.data.loadGeoJson('http://japancityshape.niiyz.com/geojson/' + city + '.json');
            map.data.setStyle({fillColor: 'green'});
        }
    };
    // 中心変更
    var changeCenter = function (address) {
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({'address': address}, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                var location = results[0].geometry.location;
                var lat = location.lat();
                var lng = location.lng();
                var latlng = {lat: lat, lng: lng};
                map.setCenter(latlng);
            } else {
                console.log("Geocode was not successful for the following reason: " + status);
            }
        });
    };
    var div = document.createElement('div');
    div.style.marginTop     = '15px';
    var setsumei = document.createElement('div');
    setsumei.innerText = '市、県、郡、区まで付けて入力してください。'
    var input = document.createElement('input');
    input.value             = initCity;
    input.style.width       = '250px';
    input.style.height      = '40px';
    input.style.fontSize    = '32px';
    input.style.background  = 'pink';
    var btn = document.createElement('button');
    btn.innerText           = "塗る";
    btn.style.width         = '100px';
    btn.style.height        = '45px';
    btn.style.fontSize      = '32px';
    google.maps.event.addDomListener(btn, 'click', function() {
        var city = input.value;
        makeShape(city);
        changeCenter(city);
    });
    div.appendChild(setsumei);
    div.appendChild(input);
    div.appendChild(btn);
    map.controls[google.maps.ControlPosition.TOP_CENTER].push(div);
    makeShape(initCity);
};
</script>
</body>
</html>
